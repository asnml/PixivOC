## 请求格式

&emsp;&emsp;请求的类型为字典，其必须拥有以下参数。在该次请求中所用不到的参数可以设置为该类型的任意值。

```python
RequestFormatStander = {
    'IdentificationNumber': str,
    'Command': int,
    'Account': str,
    'Password': str,
    'ProxyMode': int,
    'Proxy': str,
    'Timeout': int,
    'ConcurrencyNumber': int,
    'IntervalTime': int,
    'Increment': bool,
    'TID': int,
    'KeyWord': str,
    'TaskName': str,
    'SavePath': str
}
```

&emsp;&emsp;参数解释：

- IdentificationNumber（必须被正确设置）：请求标识号，字符串类型，格式为 `(S|R)\d+` 。其中 S 标识头代表着该次通讯为首次发起的请求，R 标识头表示该次通讯为返回值。
- Command（必须被正确设置）：命令标识符，int 类型。代表着请求服务器所调用的处理函数。
- Account：账户登录名，字符串类型。
- Password：账户密码，字符串类型。
- ProxyMode：代理模式，int 类型，具体值及其代表意义见下文的[命令列表及返回值](#命令列表及返回值)。
- Proxy：代理地址，字符串类型。只能使用 http 代理。
- Timeout：下载器每次网络请求的超时时间，int 类型。
- ConcurrencyNumber：使用异步请求机制下载图片时，每次进行并发的网络请求数量，int 类型。若该值设置的过大且网络状况不好，那么将会出现并发请求中的多数请求被超时中断，反复进行请求的情况。
- IntervalTime：使用同步请求机制进行网络请求时，两次请求间的间隔时间，int 类型。在程序中，一般使用同步机制进行 `Pixiv` 的 API 请求，若该值设置的过小且请求过密，可能会出现 IP 被 ban 的情况。
- Increment：是否开启超时延长机制，bool 类型，默认 True。当完成一轮[请求周期](#)时，尚存在没有下载链接，那么在下次进行请求时，将会增大超时时间。
- TID：任务ID，int 类型。要进行操作的目标任务的ID值。
- KeyWord：创建任务时的关键词，字符串类型。例如创建下载单个作品的任务，那么关键词就是该作品的PID。如果创建的是下载画师所有作品的任务，那么关键词就是该画师的ID。
- TaskName：创建任务时的任务名，字符串类型。
- SavePath：任务的保存路径，字符串类型。任务下载的图片将要保存的位置，具体保存路径将为保存路径+任务名+图片名。例如一个名为 `Test` 的任务的保存路径为 `D:\Hello` ，那么其下载的图片的路径为 `D:\Hello\Test\133250.jpg`。若任务类型为数据查询类型，无需下载图片，那么该值可设为空字符串。





## 返回格式

&emsp;&emsp;返回值为一个字典，其必定存在3个值。

```python
ReplyFormatStander = {
    'IdentificationNumber': str,
    'SendType': int,
    'Content': Any
}
```

&emsp;&emsp;参数解释：

- IdentificationNumber：同上。
- SendType：代表服务器发送该次通讯时的场景，int 类型，详情见[服务器上报标识及所含值](#服务器上报标识及所含值)。
- Content：返回的内容，具体值请参阅[服务器上报标识及所含值](#服务器上报标识及所含值)。





## 命令列表及返回值

|        命令名        |  值  |              所需参数               | 保存路径为空字符串 |                           Content                            |
| :------------------: | :--: | :---------------------------------: | :----------------: | :----------------------------------------------------------: |
|        Login         |  1   |        Account<br />Password        |                    |          bool<br />Mean: operation is successful ?           |
|        Logout        |  2   |                                     |                    |          bool<br />Mean: operation is successful ?           |
|       IsLogin        |  3   |                                     |                    |                  bool<br />Mean: is login ?                  |
|     SetProxyMode     |  4   |        ProxyMode<br />Proxy         |                    |          bool<br />Mean: operation is successful ?           |
|      SetTimeout      |  5   |               Timeout               |                    |          bool<br />Mean: operation is successful ?           |
| SetConcurrencyNumber |  6   |          ConcurrencyNumber          |                    |          bool<br />Mean: operation is successful ?           |
|   SetIntervalTime    |  7   |            IntervalTime             |                    |          bool<br />Mean: operation is successful ?           |
|     SetIncrement     |  8   |              Increment              |                    |          bool<br />Mean: operation is successful ?           |
|    GetEnvironment    |  9   |                                     |                    | list<br />Mean: str list of [<br />ProxyStatus, ProxyAddress,<br />Timeout, ConcurrencyNumber,<br />IntervalTime ] |
|      StartTask       |  11  |                 TID                 |                    |          bool<br />Mean: operation is successful ?           |
|       StopTask       |  12  |                 TID                 |                    |          bool<br />Mean: operation is successful ?           |
|      DeleteTask      |  13  |                 TID                 |                    |          bool<br />Mean: operation is successful ?           |
|     TaskDetails      |  14  |                 TID                 |                    |                 list<br />Mean: Task details                 |
|    AllTaskDetails    |  15  |                                     |                    |               list<br />Mean: All task details               |
|  AddWorkDetailsTask  | 101  | KeyWord<br />TaskName<br />SavePath |        True        | list<br />[ False, [] ] or <br />[ True, *[TaskDetails](#TaskDetails返回值) ] |
|  AddSingleWorkTask   | 102  | KeyWord<br />TaskName<br />SavePath |       False        | list<br />[ False, [] ] or <br />[ True, *[TaskDetails](#TaskDetails返回值) ] |
| AddUserWorksLinkTask | 103  | KeyWord<br />TaskName<br />SavePath |        True        | list<br />[ False, [] ] or <br />[ True, *[TaskDetails](#TaskDetails返回值) ] |
|   AddUserWorksTask   | 104  | KeyWord<br />TaskName<br />SavePath |       False        | list<br />[ False, [] ] or <br />[ True, *[TaskDetails](#TaskDetails返回值) ] |

ProxyMode 可选值及其运行模式：

- 0: 直接连接。
- 1: 代理连接，通过参数 Proxy 传入的 http 代理进行连接。
- 2: IP连接，通过将域名转换为 IP 的方式进行连接，国内用户使用该方式可以不通过代理连接上Pixiv。



## TaskDetails返回值

&emsp;PS: AllTaskDetails 的返回值为一个列表中包含多个TaskDetails的返回值。

```python
TaskDetilsReturnValue = [
    Over: bool,
    TID: int,
    TaskName: str,
    TaskType: str,
    TaskStageName: str,
    Running: bool,
    Now: int,
    Total: int,
    SavePath: str
]
```



## 服务器上报标识及所含值

&emsp;&emsp;阅读本节前，首先需要定义 TaskReport 这一数据结构。TaskReport 为任务发生变化时主动进行数据上报时的数据格式。

``````python
TaskReport = {
    'TID': int,
    'Content': Any
}
``````

- TID：进行上报的任务的ID。
- Content：上报的数据。



|     上报类型      |  值  |                    Content                    |
| :---------------: | :--: | :-------------------------------------------: |
|       Reply       |  1   |               根据请求内容而定                |
| TokenStatusChange |  2   | True: 登陆/更新成功<br />False: 登陆/更新失败 |
|    CreateTask     |  11  |                   TID: int                    |
|    DeleteTask     |  12  |                   TID: int                    |
| TaskStatusChange  |  13  |                  TaskReport                   |
|     TaskOver      |  14  |                  TaskReport                   |
|  TaskListUpdate   |  15  |                   尚未使用                    |

``````python
TaskStatusChangeReturnForamt = {
    'IdentificationNumber': str,
    'SendType': int,
    'Content': {
        'TID': int,
        'Content': [StageName: str, Now: int, Total: int]
    }
}
``````





## 任务列表及其结束返回值
```python
TaskOverReturnForamt = {
    'IdentificationNumber': str,
    'SendType': int,
    'Content': {
        'TID': int,
        'Content': Any
    }
}
```

|   TaskType    |                           简介                           |             Any              |
| :-----------: | :------------------------------------------------------: | :--------------------------: |
|  WorkDetails  |        获取作品详情，结果通过任务结束时上报返回。        | P站对应API返回值中的Response |
|  SingleWork   |                    下载单个ID的作品。                    |     ''<br />PS: 空字符串     |
| UserWorksLink | 获取用户所有作品的原图链接，结果通过任务结束时上报返回。 |  [url: str, url: str, ...]   |
|   UserWorks   |                   下载用户的所有作品。                   |              ''              |
